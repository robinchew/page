<html>
    <head>
        <meta charset="utf-8" />
        <script src="./fontInit.js"></script>
    </head>
    <body>
        <style>
            #output {
                display: flex;
                width: 290px;
                height: 210px;
                background-color: #eee;
                text-align: center;
                flex-direction: column;
                justify-content: center;
            }
        </style>
        <div id="output">
        </div>
        <!--textarea id="input">CAFE</textarea-->
        <textarea id="input"></textarea>
        <script>
            const { getTextWidth } = fontInit();

            function getFontSizeForWidth(text, maxWidth) {
                if (! text.length) {
                    return 0;
                }
                return (function loop(size, lastSize = 0, lastWidth = 0) {
                    const width = getTextWidth(text, `${size}px arial`);

                    if(width > maxWidth) {
                        return lastSize;
                    }
                    return loop(size + 1, size);
                })(1);
            }

            function div(text, fontFamily, fontSize) {
                const dom = document.createElement('div');
                dom.innerHTML = text;
                dom.style.fontSize = fontSize + 'px';
                dom.style.lineHeight = fontSize + 'px';
                dom.style.fontFamily = fontFamily;
                //dom.style.display = 'inline';
                //dom.style.whiteSpace = 'nowrap';
                dom.style.whiteSpace = 'pre';
                return dom;
            }

            (function() {
                const input = document.getElementById('input');
                const output = document.getElementById('output');

                function updateOutput(text) {
                    const size = getFontSizeForWidth(text, 290);

                    output.innerHTML = '';
                    output.style.fontSize = `${size}px`;

                    text.split('\n').forEach(text => {
                        const size = getFontSizeForWidth(text, 250);
                        output.appendChild(div(text, 'arial', size));
                    });
                }

                input.addEventListener('input', e => updateOutput(e.target.value));
                const startText = `CAFÃ‰
7am - 12pm
          Mon - Fri         
                                except holidays`;
                input.innerHTML = startText;
                updateOutput(startText);
            })();
        </script>
    </body>
</html>
